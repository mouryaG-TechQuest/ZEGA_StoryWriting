# Production Configuration for API Gateway
spring:
  profiles:
    active: production
  
  cloud:
    gateway:
      # Connection pool optimization
      httpclient:
        pool:
          type: ELASTIC
          max-connections: 1000
          max-idle-time: 30s
        connect-timeout: 5000
        response-timeout: 30s
      
      # Route optimization with caching
      routes:
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/auth/**,/api/users/**
          filters:
            - name: CircuitBreaker
              args:
                name: userServiceCircuitBreaker
                fallbackUri: forward:/fallback
        
        - id: story-service
          uri: lb://story-service
          predicates:
            - Path=/api/stories/**,/api/training-history/**
          filters:
            - name: CircuitBreaker
              args:
                name: storyServiceCircuitBreaker
                fallbackUri: forward:/fallback

# Server optimization
server:
  netty:
    connection-timeout: 20s
  compression:
    enabled: true

# Logging
logging:
  level:
    root: ERROR
    org.springframework.cloud.gateway: WARN
    org.springframework: ERROR
  file:
    name: logs/api-gateway.log
    max-size: 10MB
    max-history: 7

# Eureka client optimization
eureka:
  client:
    registry-fetch-interval-seconds: 30
  instance:
    lease-renewal-interval-in-seconds: 30

# Circuit breaker configuration
resilience4j:
  circuitbreaker:
    configs:
      default:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 10s
        permitted-number-of-calls-in-half-open-state: 3
